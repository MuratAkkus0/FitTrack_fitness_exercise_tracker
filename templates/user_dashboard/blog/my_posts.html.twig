{% extends 'user_dashboard/dashboard_template.html.twig' %}

{% block title %}My Posts
{% endblock %}

{% block content %}
	<div class="max-w-6xl mx-auto" data-controller="blog-post">
		<div class="flex items-center justify-between mb-6">
			<h1 class="text-2xl font-bold text-gray-900">My Posts</h1>
			<div class="space-x-3">
				<a href="{{ path('app_blog_index') }}" class="text-blue-600 hover:text-blue-800">
					View Community Blog
				</a>
				<a href="{{ path('app_blog_create') }}" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
					Create New Post
				</a>
			</div>
		</div>

		{% if posts|length > 0 %}
			<div class="space-y-6">
				{% for post in posts %}
					<div class="bg-white rounded-lg shadow-md p-6 border border-gray-200">
						<div class="flex items-start justify-between">
							<div class="flex-1">
								<div class="flex items-center space-x-2 mb-2">
									<h2 class="text-xl font-semibold text-gray-900">{{ post.title }}</h2>
									{% if post.isPublic %}
										<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
											Public
										</span>
									{% else %}
										<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
											Private
										</span>
									{% endif %}
								</div>

								<div class="text-gray-600 mb-4">
									<div class="flex items-center space-x-4 text-sm">
										<span>{{ post.createdAt|date('M d, Y \\a\\t g:i A') }}</span>
										{% if post.workoutLog %}
											<span class="flex items-center">
												<svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewbox="0 0 24 24">
													<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
												</svg>
												Shared from workout
											</span>
										{% endif %}
									</div>
								</div>

								<div class="text-gray-700 mb-4">
									{% if post.content|length > 300 %}
										<p>{{ post.content|slice(0, 300) }}...</p>
										<button class="text-blue-600 hover:text-blue-800 text-sm font-medium mt-2" data-action="click->blog-post#toggleContent" data-blog-post-post-id-param="{{ post.id }}">
											Read more
										</button>
										<div id="fullContent{{ post.id }}" class="hidden mt-2">
											<p class="whitespace-pre-line">{{ post.content }}</p>
											<button class="text-blue-600 hover:text-blue-800 text-sm font-medium mt-2" data-action="click->blog-post#toggleContent" data-blog-post-post-id-param="{{ post.id }}">
												Show less
											</button>
										</div>
									{% else %}
										<p class="whitespace-pre-line">{{ post.content }}</p>
									{% endif %}
								</div>

								{% if post.workoutLog %}
									<div class="bg-gray-50 rounded-lg p-4 mb-4">
										<div class="flex items-center mb-2">
											<svg class="w-5 h-5 mr-2 text-blue-600" fill="none" stroke="currentColor" viewbox="0 0 24 24">
												<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
											</svg>
											<span class="font-medium text-gray-900">Workout Details</span>
										</div>
										<div class="grid grid-cols-3 gap-4 text-sm">
											<div>
												<span class="text-gray-600">Duration:</span>
												<span class="font-medium ml-1">{{ post.workoutLog.duration }}
													min</span>
											</div>
											<div>
												<span class="text-gray-600">Exercises:</span>
												<span class="font-medium ml-1">{{ post.workoutLog.workoutLogDetails|length }}</span>
											</div>
											<div>
												<span class="text-gray-600">Date:</span>
												<span class="font-medium ml-1">{{ post.workoutLog.createdAt|date('M d, Y') }}</span>
											</div>
										</div>
									</div>
								{% endif %}
							</div>

							<div class="flex-shrink-0 ml-4">
								<div class="flex space-x-2">
									<a href="{{ path('app_blog_view', {'id': post.id}) }}" class="text-gray-600 hover:text-gray-800 p-2 rounded-md hover:bg-gray-100" title="View Post">
										<svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
										</svg>
									</a>
									<a href="{{ path('app_blog_edit', {'id': post.id}) }}" class="text-blue-600 hover:text-blue-800 p-2 rounded-md hover:bg-blue-100" title="Edit Post">
										<svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
										</svg>
									</a>
									<button data-action="click->blog-post#deletePost" data-blog-post-post-id-param="{{ post.id }}" class="text-red-600 hover:text-red-800 p-2 rounded-md hover:bg-red-100" title="Delete Post">
										<svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
										</svg>
									</button>
								</div>
							</div>
						</div>
					</div>
				{% endfor %}
			</div>
		{% else %}
			<div class="text-center py-12">
				<svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewbox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
				</svg>
				<h3 class="mt-2 text-sm font-medium text-gray-900">No posts yet</h3>
				<p class="mt-1 text-sm text-gray-500">Get started by creating your first blog post.</p>
				<div class="mt-6">
					<a href="{{ path('app_blog_create') }}" class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
						<svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewbox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
						</svg>
						Create New Post
					</a>
				</div>
			</div>
		{% endif %}
	</div>

	<!-- Success/Error Messages -->
	<div data-blog-post-target="messageContainer" class="fixed top-4 right-4 z-50"></div>
{% endblock %}
