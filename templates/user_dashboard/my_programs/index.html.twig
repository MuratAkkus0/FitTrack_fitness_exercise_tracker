{% extends 'user_dashboard/dashboard_template.html.twig' %}

{% block dashboard_content %}

	<div data-controller="program-management" data-program-management-exercises-url-value="{{ path('app_programs_exercises_api') }}" data-program-management-create-url-value="{{ path('app_programs_create') }}" data-program-management-edit-url-value="{{ path('app_programs_edit', {'id': '__ID__'}) }}" class="bg-white rounded-xl shadow-md p-6">
		<div class="flex justify-between items-center mb-6">
			<h3 class="text-xl font-bold text-indigo-900">My Training Programs</h3>
			<div class="flex space-x-3">
				<a href="{{ path('app_programs_browse_shared') }}" class="bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded-lg font-medium transition flex items-center">
					<i class="fas fa-share-alt mr-2"></i>
					Shared Programs
				</a>
				<button data-action="click->program-management#openNewProgramModal" class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg font-medium transition flex items-center">
					<i class="fas fa-plus mr-2"></i>
					New Program
				</button>
			</div>
		</div>

		{% if debug is defined %}
			<div class="bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded mb-4">
				<p>{{ debug }}</p>
			</div>
		{% endif %}

		{% if error is defined %}
			<div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
				<p>{{ error }}</p>
			</div>
		{% endif %}

		<!-- Program Cards -->
		<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
			{% if programs is defined %}
				<div class="col-span-3 mb-4 p-3 bg-yellow-100 border border-yellow-400 text-yellow-700 rounded">
					<p>
						<strong>Debug:</strong>
						Programs variable is defined. Number of programs:
						{{ programs|length }}</p>
					{% if programs|length > 0 %}
						<p>First program:
							{{ programs[0].name ?? 'No name' }}</p>
					{% endif %}
				</div>

				{% if programs|length > 0 %}
					{% for program in programs %}
						{% include 'components/program_card.html.twig' with {'program': program} %}
					{% endfor %}
				{% else %}
					<div class="col-span-3 text-center py-12 text-gray-500">
						<i class="fas fa-dumbbell text-6xl text-gray-300 mb-4"></i>
						<p class="text-lg font-medium mb-2">You don't have any training programs yet</p>
						<p class="mb-4">Click the "New Program" button to create your first program.</p>
						<button data-action="click->program-management#openNewProgramModal" class="bg-orange-500 hover:bg-orange-600 text-white px-6 py-3 rounded-lg font-medium transition">
							<i class="fas fa-plus mr-2"></i>
							Create My First Program
						</button>
					</div>
				{% endif %}
			{% else %}
				<div class="col-span-3 text-center py-12 text-red-500">
					<p class="text-lg font-medium mb-2">‚ùå Programs variable is not defined!</p>
					<p>Data may not have been sent from the controller.</p>
				</div>
			{% endif %}
		</div>
	</div>

	<!-- New/Edit Program Modal -->
	<div data-program-management-target="modal" class="fixed inset-0 hidden overflow-y-auto h-full w-full z-50">
		<div class="fixed inset-0 bg-[rgba(0,0,0,0.5)] transition-all duration-300"></div>
		<div data-program-management-target="modalContent" class="relative top-10 mx-auto p-5 border w-full max-w-2xl shadow-lg rounded-md bg-white transform transition-all duration-300 scale-95 opacity-0">
			<div class="mt-3">
				<div class="flex justify-between items-center mb-4">
					<h3 data-program-management-target="modalTitle" class="text-lg font-bold text-indigo-900">Create New Program</h3>
					<button data-action="click->program-management#closeModal" class="text-gray-400 hover:text-gray-600 transition-colors duration-200">
						<i class="fas fa-times"></i>
					</button>
				</div>

				<form data-program-management-target="form" data-action="submit->program-management#submitForm" class="space-y-4">
					<input type="hidden" id="programId" name="programId">

					<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
						<div class="md:col-span-2">
							<label for="programName" class="block text-sm font-medium text-gray-700 mb-1">Program Name *</label>
							<input type="text" id="programName" name="programName" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200" placeholder="e.g., Upper Body Workout">
						</div>

						<div class="md:col-span-2">
							<label for="programDescription" class="block text-sm font-medium text-gray-700 mb-1">Description</label>
							<textarea id="programDescription" name="programDescription" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200" placeholder="Describe your training program..."></textarea>
						</div>

						<div>
							<label for="workoutsPerWeek" class="block text-sm font-medium text-gray-700 mb-1">Weekly Workout Count</label>
							<select id="workoutsPerWeek" name="workoutsPerWeek" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
								<option value="">Select</option>
								<option value="1">1 day</option>
								<option value="2">2 days</option>
								<option value="3">3 days</option>
								<option value="4">4 days</option>
								<option value="5">5 days</option>
								<option value="6">6 days</option>
								<option value="7">7 days</option>
							</select>
						</div>

						<div>
							<label for="workoutDuration" class="block text-sm font-medium text-gray-700 mb-1">Duration (minutes)</label>
							<input type="number" id="workoutDuration" name="workoutDuration" min="15" max="180" step="15" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200" placeholder="45">
						</div>

						<div class="md:col-span-2">
							<label for="difficultyLevel" class="block text-sm font-medium text-gray-700 mb-1">Difficulty Level</label>
							<select id="difficultyLevel" name="difficultyLevel" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200">
								<option value="">Select</option>
								<option value="beginner">Beginner</option>
								<option value="intermediate">Intermediate</option>
								<option value="advanced">Advanced</option>
								<option value="expert">Expert</option>
							</select>
						</div>
					</div>

					<div class="mt-6">
						<label class="block text-sm font-medium text-gray-700 mb-3">
							Select Exercises (<span data-program-management-target="selectedExercisesCount">0</span>
							selected)
						</label>
						<div data-program-management-target="exerciseList" class="max-h-60 overflow-y-auto border border-gray-300 rounded-md p-3 bg-gray-50">
							<div class="text-center text-gray-500 py-4">Loading exercises...</div>
						</div>
					</div>

					<div class="flex justify-end space-x-3 mt-6 pt-4 border-t border-gray-200">
						<button type="button" data-action="click->program-management#closeModal" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition-colors duration-200">
							Cancel
						</button>
						<button type="submit" data-program-management-target="submitBtn" class="px-4 py-2 bg-orange-500 text-white rounded-md hover:bg-orange-600 transition-colors duration-200">
							Create Program
						</button>
					</div>
				</form>
			</div>
		</div>
	</div>

	<style>
		[data-program-management-target="modal"].active {
			display: block !important;
		}

		[data-program-management-target="modal"].active [data-program-management-target="modalContent"] {
			transform: scale(1) !important;
			opacity: 1 !important;
		}

		.exercise-item {
			@apply transition-colors duration-200;
		}

		.exercise-item:hover {
			@apply bg-gray-50;
		}

		.exercise-item.selected {
			@apply bg-sky-50 border-sky-500;
		}

		.hidden {
			display: none !important;
		}
	</style>

{% endblock %}
